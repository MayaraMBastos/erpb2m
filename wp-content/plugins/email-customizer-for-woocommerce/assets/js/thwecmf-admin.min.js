function thwecmfEditBuilderBlocks(elm,blockId,blockName){thwecmf_settings.render_edit_block_sidebar_form(elm,blockId,blockName)}function thwecmfClearTemplateBuilder(elm){thwecmf_settings.clear_tbuilder_sidebar(elm)}function thwecmfDeleteBuilderBlocks(elm){thwecmf_settings.delete_builder_blocks(elm)}function thwecmfUploadImage(elm,prop){thwecmf_settings.setup_wp_image_upload(elm,prop)}function thwecmfClickAddRow(elm){thwecmf_settings.add_row_builder_action(elm)}function thwecmfSidebarBackNavigation(elm){thwecmf_settings.template_sidebar_back_navigation(elm)}function thwecmfCollapseCategory(elm){thwecmf_settings.setup_category_toggle(elm)}function thwecmfSidebarEditElementForm(elm){thwecmf_settings.click_block_edit_sidebar_form_save(elm)}function thwecmfRemoveImgUploaded(elm){thwecmf_settings.remove_image_uploaded(elm)}function thwecmfClickTestMail(elm){thwecmf_settings.click_test_mail_button(elm)}function thwecClickTestMailAction(elm){thwecmf_settings.click_test_mail_action(elm)}function thwecmfCloseTestMail(elm){thwecmf_settings.close_test_mail_box(elm)}function thwecmfSaveTemplate(elm){thwecmf_settings.builder_prepare_save_template(elm)}function thwecmfTemplateEditListner(elm){thwecmf_settings.edit_template_event_listner(elm)}function thwecmfTemplateMapValidation(elm){thwecmf_settings.template_map_validation(elm)}var thwecmf_settings=function($,window,document){"use strict";function validate_temp_name(tname,dependend){var validate=[],validation_set=[];return""==tname&&(validate.status=!1,validate.validate_flag="name",validate.message=dependend+" name is empty",validation_set.push(validate)),"Hook"==dependend?0==/^[a-zA-Z_]*$/.test(tname)&&(validate.status=!1,validate.validate_flag=!1,validate.message='Use only letters ([a-z],[A-Z]) and underscores ("_") for template name',validation_set.push(validate)):"Template"==dependend&&0==/^[a-zA-Z0-9-_ ]*$/.test(tname)&&(validate.status=!1,validate.validate_flag=!1,validate.message='Use only letters ([a-z],[A-Z]), digits ([0-9]), hyphen ("-") and underscores ("_") for template name',validation_set.push(validate)),validation_set}function click_test_mail_button(elm){var test_mail_box=$(elm).siblings(".thwecmf-test-mail-wrapper");test_mail_box.addClass("thwecmf-test-mail-active"),test_mail_box.find(".thwecmf-test-mail-validate-notice").html(""),test_mail_box.find(".thwecmf-test-mail-input").removeClass("has-value")}function click_test_mail_action(elm){var test_mail_ref=$(elm).closest(".thwecmf-test-mail-popup-actions"),mail_id=test_mail_ref.find("input.thwecmf-test-mail-input").val(),valid_result=validate_test_email(mail_id);if(valid_result.valid){$(test_mail_ref).find(".thwecmf-test-mail-validate-notice").html(""),template_preview_content(!1);var test_mail_data=$("#thwecmf_tbuilder_editor_preview").html(),css=$("#thwecmf_template_css").html();css+=$("#thwecmf_template_css_preview_override").html(),prepare_ajax_test_email(test_mail_data,css,mail_id)}else{var error_msgs="";$.each(valid_result.errors,function(key,value){error_msgs+='<p class="error-notice"> # '+value+"</p>"}),$(test_mail_ref).find(".thwecmf-test-mail-validate-notice").html(error_msgs)}}function prepare_ajax_test_email(mail_data,mail_css,mail_id){var template_ajax_load=$("#thwecmf-ajax-load-modal"),test_data={thwecmf_security:thwecmf_admin_var.ajax_nonce,action:"thwecmf_template_actions",thwecmf_action_index:"settings",test_mail_data:mail_data,test_mail_css:mail_css,test_mail_id:mail_id};$.ajax({type:"POST",url:ajaxurl,data:test_data,beforeSend:function(){template_ajax_load.addClass("thwecmf-ajax-loading")},success:function(data){var msg=data?"Test email sent":"Test email was not sent. Try again.",msg_class=data?"success":"error";$(".thwecmf-test-mail-popup-actions").find(".thwecmf-test-mail-validate-notice").html('<p class="'+msg_class+'-notice">'+msg+"</p>")},complete:function(){template_ajax_load.removeClass("thwecmf-ajax-loading")},error:function(){alert("error")}})}function validate_test_email(mail_id){var validation_set={},error_msg=[];validation_set.valid=!0;var builder_valid=!0,email_valid=!0,split_pattern=mail_id.split("@");if(split_pattern){var validation1=(split_pattern[0],split_pattern[1]);if(""!=validation1&&null!=validation1){var valid_split=validation1.split("."),validation21=(valid_split[0],valid_split[1]);null!=validation21&&""!=validation21?email_valid=!0:(email_valid=!1,error_msg.push(TEST_MAIL_NOTICE))}else email_valid=!1,error_msg.push(TEST_MAIL_NOTICE)}return 0==$("#tbf_t_builder").find(".thwecmf-builder-block").length&&(error_msg.push("Add contents to the builder"),builder_valid=!1),validation_set.valid=!(!email_valid||!builder_valid),validation_set.errors=error_msg,validation_set}function close_test_mail_box(elm){$(elm).closest(".thwecmf-test-mail-wrapper").removeClass("thwecmf-test-mail-active")}function reload_page_listner(){window.addEventListener("beforeunload",function(event){prepare_page_reload_event()})}function prepare_page_reload_event(){var builder_obj=$("#tbf_t_builder"),block_length=builder_obj.find(".thwecmf-builder-block").length,data_track=builder_obj.attr("data-track-save"),data_global=builder_obj.attr("data-global-id"),data_css=builder_obj.attr("data-css-change");if(builder_obj.length>0&&block_length>0&&data_track!=data_global)event.returnValue="o/";else{if("false"!=data_css)return;event.returnValue="o/"}}function resize_scroll_support(){setup_sidebar_scrolls(),$(window).on("resize",function(){var active_tab1=$("#thwecmf-sidebar-configure.thwecmf-active-tab"),active_tab2=$("#thwecmf-sidebar-settings.thwecmf-active-tab");active_tab1.length>0?setup_sidebar_scrolls(active_tab1):active_tab2.length>0&&setup_sidebar_panel_scrolls(active_tab2,!0,!0,!0)})}function setup_sidebar_scrolls(active_tab1){active_tab1=active_tab1||$("#thwecmf-sidebar-configure.thwecmf-active-tab");var sidebar_wrapper=$("#thwecmf-sidebar-element-wrapper"),height1=sidebar_wrapper.height()-122;active_tab1.find(".thwecmf-layers-outer-wrapper").css({height:height1})}function setup_sidebar_panel_scrolls(active_tab2,layout_wrapper,edit_wrapper,element_wrapper){active_tab2=active_tab2||$("#thwecmf-sidebar-settings.thwecmf-active-tab");var sidebar_wrapper=$("#thwecmf-sidebar-element-wrapper"),height2=sidebar_wrapper.height()-66,height3=sidebar_wrapper.height()-124;layout_wrapper&&active_tab2.find(".wecmf-layout-panel-outer-wrapper").css({height:height2}),edit_wrapper&&active_tab2.find(".thwecmf_field_form_outer_wrapper").css({height:height3}),element_wrapper&&active_tab2.find(".outer-wrapper").css({height:height2})}function setup_category_toggle(elm){var click_cat=($(elm),$(elm).closest(".grid-category"));click_cat.hasClass("category-collapse")?(click_cat.removeClass("category-collapse"),$(".thwecmf-tbuilder-elm-grid-layout-element").find(".grid-category").not(click_cat).each(function(index,el){$(this).addClass("category-collapse")})):click_cat.addClass("category-collapse")}function tiptip_tooltips_setup(){var tiptip_args={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200};$(".tips").tipTip(tiptip_args)}function setup_colorpicker(form){form.find(".thpladmin-colorpick").iris({change:function(event,ui){$(this).parent().find(".thpladmin-colorpickpreview").css({backgroundColor:ui.color.toString()})},hide:!0,border:!0}).click(function(){$(".iris-picker").hide(),$(this).closest("td").find(".iris-picker").show()}),$("body").click(function(){$(".iris-picker").hide()}),$(".thpladmin-colorpick").click(function(event){event.stopPropagation()})}function setup_colorpick_preview(form){form.find(".thpladmin-colorpick").each(function(){$(this).parent().find(".thpladmin-colorpickpreview").css({backgroundColor:this.value})})}function get_field_value(form,type,name){var value="";switch(type){case"select":value=form.find("select[name=i_"+name+"]").val(),value=null==value?"":value;break;case"checkbox":value=form.find("input[name=i_"+name+"]").prop("checked"),value=value?1:0;break;case"textarea":value=form.find("textarea[name=i_"+name+"]").val(),value=null==value?"":value;break;default:value=form.find("input[name=i_"+name+"]").val(),value=null==value?"":value}return value}function set_field_value(form,type,name,value,multiple){switch(type){case"select":1==multiple&&"string"==typeof value&&(value=value.split(","),name+="[]"),form.find('select[name="i_'+name+'"]').val(value);break;case"checkbox":value=1==value,form.find("input[name=i_"+name+"]").prop("checked",value);break;case"textarea":form.find("textarea[name=i_"+name+"]").val(value);break;default:form.find("input[name=i_"+name+"]").val(value)}}function thwecmfEscapeHTML(html){var fn=function(tag){return{'"':"&quot;","'":"&#39;"}[tag]||tag};return html.replace(/[&<>"]/g,fn)}function escapeScripts(html){var div=document.createElement("div");div.innerHTML=html;for(var scripts=div.getElementsByTagName("script"),i=scripts.length;i--;)scripts[i].parentNode.removeChild(scripts[i]);return div.innerHTML}function thwecmf_sanitize_field(string){return $($.parseHTML(string)).text()}function generate_rand_string(){var block_id=$("#tbf_t_builder").attr("data-global-id"),new_block_id=parseInt(block_id)+1;return $("#tbf_"+new_block_id).length>0?generate_random_id(new_block_id):$("#tbf_t_builder").attr("data-global-id",new_block_id),new_block_id}function generate_random_id(new_id){var new_id=parseInt(new_id)+1;$("#tbf_"+new_id).length>0?generate_random_id(new_id):$("#tbf_t_builder").attr("data-global-id",new_id)}function clean_block_name(name){return name.replace(/_/g," ").replace(/\b[a-z]/g,function(string){return string.toUpperCase()})}function is_row(name){return-1!==$.inArray(name,BUILDER_ROWS)}function is_column(name){return-1!==$.inArray(name,BUILDER_COLS)}function is_address(name){return-1!==$.inArray(name,ADDRESS_BLOCKS)}function is_hook(name){return-1!==$.inArray(name,BUILDER_HOOKS)}function is_content_inlcude_img(name){return-1!==$.inArray(name,IMG_CONTENT_BLOCKS)}function clear_tbuilder_sidebar(elm){var popup=$("#thwecmf_confirmation_alerts"),builder_css=$("#tbf_t_builder").attr("data-css-change");popup.find(".thwecmf-messages").html($("#thwecmf_clear_builder_confirm").html()),($(".thwecmf-builder-elm-layers .thwecmf-panel-builder-block").length>1||"false"==builder_css)&&popup.dialog("open")}function confirmation_tbuilder_clear(){var tb_builder=$("#tbf_t_builder");tb_builder.find(".thwecmf-builder-column").empty(),$("div.thwecmf-builder-elm-layers").empty(),setup_blank_sidebar_msg(),tb_builder.attr("data-css-props",TB_DEFAULT),tb_builder.attr("data-global-id","1000"),tb_builder.attr("data-track-save","1000"),$("#thwecmf_template_css_override").html(""),$("#thwecmf_template_css_preview_override").html("")}function reset_row_column_width(row,columns){var siblings_props,col_width=100/parseInt(columns);$("#tbf_t_builder").find("#tbf_"+row+" tbody > tr > td").each(function(index,el){var data_props=$(this).attr("data-css-props");if($(this).attr("id")){var block_id=$(this).attr("id").replace("tbf_","");if(data_props)data_props=JSON.parse(data_props),siblings_props=data_props;else var data_props=DEF_COL_PROPS;data_props.width=col_width+"%";var data_props_json=JSON.stringify(data_props);$(this).attr("data-css-props",data_props_json),prepare_builder_block_css(data_props,block_id,"column_clone")}})}function highlight_focus_blocks(b_elm,p_elm){var tbuilder_ref=$("#tbf_t_builder"),panel_ref=$(".thwecmf-sidebar-config-elm-layers");tbuilder_ref.find(".thwecmf-builder-highlight").removeClass("thwecmf-builder-highlight"),panel_ref.find(".thwecmf-panel-highlight").removeClass("thwecmf-panel-highlight"),p_elm.addClass("thwecmf-panel-highlight"),b_elm.addClass("thwecmf-builder-highlight"),$("html, body").animate({scrollTop:track_element_position_b(b_elm)},500);var panel_container=$(".thwecmf-layers-outer-wrapper");panel_container.animate({scrollTop:track_element_position_p(p_elm,panel_container)},500),setTimeout(function(){p_elm.removeClass("thwecmf-panel-highlight"),b_elm.removeClass("thwecmf-builder-highlight")},3e3)}function track_element_position_b(elm){return parseInt(elm.offset().top)-200}function track_element_position_p(elm,container){return parseInt(elm.offset().top-container.offset().top+container.scrollTop())-200}function builder_css_generator(props){var css="";return $.each(props,function(name,css_prop){if(name in BUILDER_CSS_PROPS){var css_pname=BUILDER_CSS_PROPS[name].name;css_prop=css_prop||DEFAULT_CSS[css_pname],css_prop&&(css+=css_pname+":"+css_prop+";")}}),css}function prepare_builder_css_props(props,keys){var new_props={};return $.each(keys,function(i,name){new_props[name]=props[name]}),new_props}function css_parent_selector(blockId,isPrev){var p_selector="#"+blockId;return isPrev?p_selector:p_selector+" "}function add_row_builder_action(elm){reset_sidebar_status(!1);setup_sidebar_content("layout"),setup_sidebar_panel_scrolls(!1,!0,!1,!1)}function delete_builder_blocks(elm){if($(elm).closest("div.thwecmf-panel-builder-block").hasClass("thwecmf-hooks")){var id=$(elm).closest("div.thwecmf-panel-builder-block").attr("id");$(elm).closest("div.thwecmf-panel-builder-block").remove();var block=$("#tbf_t_builder").find("#tbf_"+id),block_parent=block.closest(".thwecmf-columns");block.remove(),block_parent.find(".thwecmf-builder-block").length<1&&block_parent.find(".thwecmf-hook-code").length<1&&block_parent.html(EMPTY_TD_DATA)}else{var select_block=$(elm).closest("div.thwecmf-panel-builder-block"),delete_panel_elm=select_block,delete_id=select_block.attr("id"),builder_element=$("#tbf_t_builder").find("#tbf_"+delete_id),panel_element=$("div.thwecmf-builder-elm-layers").find("#"+delete_id);if(delete_panel_elm.hasClass("thwecmf-rows")||delete_panel_elm.hasClass("thwecmf-elements")){var builder_element_parent=builder_element.closest(".thwecmf-columns");builder_element.remove(),panel_element.remove(),builder_element_parent.find(".thwecmf-builder-block").length<1&&builder_element_parent.find(".thwecmf-hook-code").length<1&&builder_element_parent.html(EMPTY_TD_DATA)}else if(delete_panel_elm.hasClass("thwecmf-columns")){var builder_element_parent=builder_element.closest(".thwecmf-row"),panel_element_parent=panel_element.closest(".thwecmf-rows"),columns=panel_element_parent.attr("data-columns");if(columns<=1)builder_element_parent.remove(),panel_element_parent.remove();else{var updated_columns=parseInt(columns)-1;panel_element_parent.attr("data-columns",updated_columns),builder_element_parent.attr("data-column-count",updated_columns),builder_element.remove(),panel_element.remove();var builder_element_parent_id=builder_element_parent.attr("id").replace("tbf_","");reset_row_column_width(builder_element_parent_id,updated_columns)}}}setup_blank_sidebar_msg()}function render_edit_block_sidebar_form(elm,blockId,blockName){setup_sidebar_content("settings"),populate_sidebar_content($("#thwecmf-sidebar-settings"),blockId,blockName),reset_sidebar_status(!1);var form=$("#thwecmf_builder_block_form");set_field_value(form,"hidden","thwecmf_block_id",blockId,0),set_field_value(form,"hidden","thwecmf_block_name",blockName,0),setup_colorpicker(form),setup_colorpick_preview(form),tiptip_tooltips_setup(),additional_sidebar_styles(form),setup_sidebar_panel_scrolls(!1,!1,!0,!1)}function additional_sidebar_styles(form){form.find(".thwecmf-aligment-icon-wrapper").each(function(index,el){var icon_val=$(this).find('input[type="hidden"]').val();$(this).find(".img-wrapper[data-align='"+icon_val+"']").addClass("thwecmf-active-icon")})}function populate_sidebar_content(content,blockId,blockName){var form=$("#thwecmf_builder_block_form");is_row(blockName)?content.find(".thwecmf_field_form_general td").html($("#thwecmf_field_form_id_row").html()):is_column(blockName)?content.find(".thwecmf_field_form_general td").html($("#thwecmf_field_form_id_col").html()):content.find(".thwecmf_field_form_general td").html($("#thwecmf_field_form_id_"+blockName).html()),populate_block_general_form(form,blockId,blockName)}function clean_text_data(text){return text.replace(/&#39;/g,"'").replace(/&quot;/g,'"')}function populate_block_general_form(form,blockId,blockName){var ref_elem=$("#tbf_"+blockId),block_props_json=ref_elem.attr("data-css-props"),block_props=!!block_props_json&&JSON.parse(block_props_json),url_props_json=ref_elem.attr("data-text-props"),url_props=url_props_json?JSON.parse(url_props_json):"",default_upload_url=form.find(".thwecmf-upload-preview").attr("data-default-url"),def_vals=form_default_values(blockName);block_props&&!$.isEmptyObject(block_props)&&$.each(block_props,function(key,value){var props=EDIT_FORM_PROPS[key];EDIT_FORM_PROPS[key].attribute&&"yes"==EDIT_FORM_PROPS[key].attribute&&(value="upload_img_url"===key?"inline-block"==value?url_props[key]:"":url_props[key],"textarea_content"!=key&&"content"!=key||(value=clean_text_data(url_props[key]))),"fourside"==props.type&&(props.type="text"),"upload_img_url"==key&&(value=""==value?default_upload_url:value,form.find(".thwecmf-img-preview-image .thwecmf-upload-preview img").attr("src",value),value!=default_upload_url&&form.find(".thwecmf-img-preview-"+blockName+" .thwecmf-remove-upload-btn").removeClass("thwecmf-remove-upload-inactive"),form.find(".thwecmf-img-preview-"+blockName+" .thwecmf-upload-preview img").attr("src",value)),""==value&&""!=def_vals&&key in def_vals&&(value=def_vals[key]),set_field_value(form,props.type,props.name,value,0)})}function form_default_values(blockName){var default_values={};switch(blockName){case"one_column":case"two_column":default_values={p_t:"0px",p_r:"0px",p_b:"0px",p_l:"0px",m_t:"0px",m_r:"auto",m_b:"0px",m_l:"auto",b_t:"0px",b_r:"0px",b_b:"0px",b_l:"0px",bg_position:"center"};break;case"one_column_one":default_values={width:"100%",b_t:"1px",b_r:"1px",b_b:"1px",b_l:"1px",border_color:"#dddddd",border_style:"dotted"};break;case"two_column_one":case"two_column_two":default_values={width:"50%",b_t:"1px",b_r:"1px",b_b:"1px",b_l:"1px",border_color:"#dddddd",border_style:"dotted"};break;case"temp_builder":default_values={b_t:"1px",b_r:"1px",b_b:"1px",b_l:"1px",border_style:"solid",border_color:"#dedede",bg_color:"#edf1e4"};break;default:default_values=""}return default_values}function add_builder_elements(blockName,blockId,col_count){var new_id=generate_rand_string(),track_html=prepare_sidebar_row_html(blockName,new_id);sidebar_track_data_blocks(prepare_builder_content_html(blockName,col_count),track_html,blockId),setup_blank_sidebar_msg()}function prepare_sidebar_row_html(blockName,row_id){if(is_row(blockName)){var html='<div id="'+row_id+'" class="thwecmf-rows thwecmf-panel-builder-block" data-columns="'+COL_TO_NUM[blockName]+'">';LAYOUT_HELPER.row="tbf_"+row_id,html+=$("#thwecmf_tracking_panel_row_html").html(),html=html.replace("{bl_id}",row_id),html=html.replace("{bl_name}",blockName),html=html.replace('data-icon-attr="{bl_name}"','data-icon-attr="'+blockName+'"'),html+='<div class="thwecmf-column-set">';for(var i=1;i<=COL_TO_NUM[blockName];i++){var column_id=generate_rand_string();LAYOUT_HELPER["column_"+i]="tbf_"+column_id,html+=prepare_sidebar_column_html(row_id,column_id,blockName,i)}html+='<div class="btn-add-column-wrap">',html+='<div class="panel-add-btn btn-add-column thwecmf-premium-disabled-feature" data-parent="'+row_id+'">',html+="<a>Add Column</a></div>",html+='<span class="th-premium-feature-msg th-premium-feature-msg-add-column">Upgrade</span>',html+="</div></div>"}else if(is_hook(blockName)){var html=(clean_block_name(blockName),'<div id="'+row_id+'" class="thwecmf-hooks thwecmf-panel-builder-block">');html+=$("#thwecmf_tracking_panel_hook_html").html(),html=html.replace("{name}",clean_block_name(blockName)),html+="</div>",LAYOUT_HELPER.hook="tbf_"+row_id}else{var html='<div id="'+row_id+'" class="thwecmf-elements thwecmf-panel-builder-block">';html+=$("#thwecmf_tracking_panel_elm_html").html(),html=html.replace("{name}",clean_block_name(blockName)),html=html.replace("{bl_id}",row_id),html=html.replace("{bl_name}",blockName),html=html.replace("{bl_attr_name}",blockName.toLowerCase()),html+="</div>;",LAYOUT_HELPER.element="tbf_"+row_id}return html}function prepare_sidebar_column_html(row_id,column_id,blockName,i){var column_name=blockName+"_"+NUM_TO_WORDS[i];is_column(column_name)||(column_name="column_clone");var t_html='<div id="'+column_id+'" class="thwecmf-columns thwecmf-panel-builder-block" data-parent="'+row_id+'">';return t_html+=$("#thwecmf_tracking_panel_col_html").html(),t_html=t_html.replace("{bl_id}",column_id),t_html=t_html.replace("{bl_name}",column_name),t_html=t_html.replace('data-icon-attr="{bl_name}"','data-icon-attr="'+column_name+'"'),t_html+='<div class="thwecmf-element-set">',t_html+='<div class="thwecmf-hidden-sortable thwecmf-elements"></div><div class="thwecmf-btn-add-element panel-add-btn panel-add-element"><a href="#">Add Element</a></div>',t_html+="</div></div>"}function setup_blank_sidebar_msg(){$("div.thwecmf-builder-elm-layers").find(".thwecmf-rows").length<1?$(".thwecmf-empty-layer-msg").removeClass("thwecmf-layers-toggle"):$(".thwecmf-empty-layer-msg").addClass("thwecmf-layers-toggle")}function sidebar_track_data_blocks(builder_html,track_html,blockId){if(blockId){var id="tbf_"+blockId;$(track_html).insertBefore($("div.thwecmf-builder-elm-layers").find("#"+blockId+" > .thwecmf-element-set > div.panel-add-element"));var target=$("#tbf_t_builder").find("#"+id);target.find(">.thwecmf-btn-add-element").length>0&&target.find(">.thwecmf-btn-add-element").remove(),target.append(builder_html)}else $("div.thwecmf-builder-elm-layers").append(track_html),$("#tbf_t_builder .thwecmf-builder-column").append(builder_html)}function prepare_builder_content_html(blockName,col_count){var block_elm="",elm_type="";"one_column"==blockName?(block_elm=$("#thwecmf_template_layout_1_col"),elm_type="layout"):"two_column"==blockName?(block_elm=$("#thwecmf_template_layout_2_col"),elm_type="layout"):"billing_address"==blockName?(block_elm=$("#thwecmf_template_elm_billing_address"),elm_type="block"):"shipping_address"==blockName?(block_elm=$("#thwecmf_template_elm_shipping_address"),elm_type="block"):"text"==blockName?(block_elm=$("#thwecmf_template_elm_text"),elm_type="block"):"image"==blockName?(block_elm=$("#thwecmf_template_elm_image"),elm_type="block"):"divider"==blockName?(block_elm=$("#thwecmf_template_elm_divider"),elm_type="block"):"gap"==blockName?(block_elm=$("#thwecmf_template_elm_gap"),elm_type="block"):"email_header"==blockName?(block_elm=$("#thwecmf_template_hook_email_header"),elm_type="hook"):"email_order_details"==blockName?(block_elm=$("#thwecmf_template_hook_order_details"),elm_type="hook"):"before_order_table"==blockName?(block_elm=$("#thwecmf_template_hook_before_order_table"),elm_type="hook"):"after_order_table"==blockName?(block_elm=$("#thwecmf_template_hook_after_order_table"),elm_type="hook"):"order_meta"==blockName?(block_elm=$("#thwecmf_template_hook_order_meta"),elm_type="hook"):"customer_details"==blockName?(block_elm=$("#thwecmf_template_hook_customer_address"),elm_type="hook"):"email_footer"==blockName&&(block_elm=$("#thwecmf_template_hook_email_footer"),elm_type="hook");var block_html="";return block_elm.length&&(block_html="layout"==elm_type?clean_content_layout_html(block_elm,blockName):"hook"==elm_type?clean_content_element_html(block_elm,blockName,"hook",!1):clean_content_element_html(block_elm,blockName,"element",col_count)),block_html}function clean_content_layout_html(block_elm,blockName){var html=block_elm.html();html=html.replace(blockName,LAYOUT_HELPER.row);for(var i=1;i<=COL_TO_NUM[blockName];i++){var column_name="column_"+i,replace_name=blockName+"_"+i;html=html.replace(replace_name,LAYOUT_HELPER[column_name])}return LAYOUT_HELPER={},html}function clean_content_element_html(block_elm,blockName,index,col_count){var html=block_elm.html();return html=html.replace("{"+blockName+"}",LAYOUT_HELPER[index]),LAYOUT_HELPER={},html}function setup_sidebar_content($active_tab){"configure"==$active_tab||("layout"==$active_tab?$("#thwecmf-sidebar-settings").html($("#thwecmf_builder_panel_layout").html()):"layout-elements"==$active_tab?$("#thwecmf-sidebar-settings").html($("#thwecmf_template_builder_panel_layout_element").html()):"settings"==$active_tab&&$("#thwecmf-sidebar-settings").html($("#thwecmf_builder_block_edit_form").html()))}function template_sidebar_back_navigation(elm){$(elm).data("nav");reset_sidebar_status(!0)}function click_block_edit_sidebar_form_save(elm){save_sidebar_edit_form($("#thwecmf_builder_block_form"))}function form_textarea_manipulate(str){var arrayOfLines=str.split(/\r?\n/),formated_content="";return $.each(arrayOfLines,function(index,item){formated_content+="<div class='wecmf-txt-wrap'>"+item+"<br></div>"}),formated_content}function save_sidebar_edit_form(form){var block_id=get_field_value(form,"hidden","thwecmf_block_id"),block_name=get_field_value(form,"hidden","thwecmf_block_name"),sidebar_form_valid=[],save_block=$("#tbf_"+block_id),css_props={},js_props={},url_props={},data_json_css=save_block.attr("data-css-props"),data_json_text=save_block.attr("data-text-props");$("#thwecmf-sidebar-element-wrapper").find(".thwecmf-upload-preview").attr("data-default-url");data_json_css=$.parseJSON(data_json_css),data_json_text=$.parseJSON(data_json_text);var data_css=$.extend({},data_json_css,data_json_text);if($.each(EDIT_FORM_PROPS,function(key,props){if(key in data_css){var value=get_field_value(form,props.type,props.name);if(void 0!==props.attribute){if("textarea_content"==key)return js_props[key]=thwecmfEscapeHTML(escapeScripts(value)),css_props[key]="",!0;if("content"==key)return js_props[key]=thwecmfEscapeHTML(thwecmf_sanitize_field(value)),css_props[key]="",!0;js_props[key]=value}"upload_img_url"===key&&(url_props[key]=value,value=""!==value?"inline-block":"none"),css_props[key]=value}}),0===sidebar_form_valid.length){$("#thwecmf-sidebar-settings").find("#sb_validation_msg").html("");var text_json_props=JSON.stringify(js_props);if(css_props){var css_json_props=JSON.stringify(css_props);save_block.attr("data-css-props",css_json_props)}if(js_props&&save_block.attr("data-text-props",text_json_props),is_address(block_name)){var align_float=css_props.align;css_props.align="",$("#tbf_"+block_id).find(".thwecmf-address-alignment").attr("align",align_float)}else if("order_details"==block_name){var align_float=css_props.align;$("#tbf_"+block_id).find(".order-padding").attr("align",align_float)}"text"==block_name&&(js_props.textarea_content=form_textarea_manipulate(js_props.textarea_content)),prepare_builder_block_css(css_props,block_id,block_name),set_image_dimension_attributes(block_name,save_block),prepare_builder_text_override(js_props,block_id,block_name),setup_colorpick_preview(form),$("#thwecmf_builder_save_messages").html("Settings Saved").addClass("thwecmf-show-save thwecmf-save-success"),$("#thwecmf_save_settings_button").find(".thwecmf_save_form").attr("disabled",!0),setTimeout(function(){$("#thwecmf_builder_save_messages").removeClass("thwecmf-show-save thwecmf-save-success"),$("#thwecmf_save_settings_button").find(".thwecmf_save_form").removeAttr("disabled")},3e3)}else{var message="";$.each(sidebar_form_valid,function(status,msg){message+='<p class="thwecmf-msg-error">'+msg.message+"</p>"}),$("#thwecmf-sidebar-settings").find("#sb_validation_msg").html(message)}$("#tbf_t_builder").attr("data-css-change",!1)}function set_image_dimension_attributes(name,obj){if(is_content_inlcude_img(name)){var img_obj=obj.find("img"),i_width=img_obj.width(),i_height=img_obj.height(),comp_size={c_width:i_width,c_height:i_height};img_obj.attr({width:i_width,height:i_height}),obj.attr("data-misc",JSON.stringify(comp_size))}}function prepare_builder_block_css(props,block_id,block_name){var tb_css_override_elm=$("#thwecmf_template_css_override"),tb_css_override=tb_css_override_elm.html();tb_css_override+=prepare_builder_css_override(props,"tbf_"+block_id,block_name,!0),tb_css_override_elm.html(tb_css_override);var prev_css_override_elm=$("#thwecmf_template_css_preview_override"),prev_css_override=prev_css_override_elm.html();prev_css_override+=prepare_builder_css_override(props,"tpf_"+block_id,block_name,!0),prev_css_override_elm.html(prev_css_override)}function prepare_builder_css_override(props,blockId,blockName,isPrev){var css="";switch(blockName){case"one_column":case"two_column":css=prepare_layout_row_css_override(props,blockId,isPrev);break;case"one_column_one":case"two_column_one":case"two_column_two":css=prepare_layout_col_css_override(props,blockId,isPrev);break;case"billing_address":case"shipping_address":case"text":case"image":case"gap":case"divider":case"t_builder":css=prepare_block_css_override(props,blockId,blockName,isPrev);break;default:css=""}return css}function prepare_builder_text_override(js_props,block_id,block_name){block_id="tbf_"+block_id;var text_elm_class=get_text_props(js_props,block_id,block_name);$.each(text_elm_class,function(name,props){if(""==props.class)var block_ref=$("#"+block_id);else{var block_ref=$("#"+block_id).find(props.class);block_ref=block_ref.length<1?$("#"+block_id):block_ref}if(block_ref)if("image"==props.attribute)block_ref.attr("src",js_props[name]);else if("html"==props.attribute)if("text"==block_name){var formated_txt=js_props[name].replace(/\r?\n/g,"<br/>");formated_txt=thwecmfEscapeHTML(formated_txt),block_ref.html(formated_txt)}else block_ref.html(js_props[name]);else"text"==props.attribute?block_ref.text(js_props[name]):"link"==props.attribute?block_ref.attr("href",js_props[name]):"title"==props.attribute&&block_ref.attr("title",js_props[name])})}function prepare_layout_row_css_override(props,blockId,isPrev){var p_selector=css_parent_selector(blockId,isPrev),w_selector=p_selector+".thwecmf-row",row_props=prepare_builder_css_props(props,["height","p_t","p_r","p_b","p_l","m_t","m_r","m_b","m_l","b_t","b_r","b_b","b_l","border_style","border_color","bg_color"]),row_css=w_selector+" {";return row_css+=builder_css_generator(row_props),row_css+="}"}function prepare_layout_col_css_override(props,blockId,isPrev){var p_selector=css_parent_selector(blockId,isPrev),w_selector=p_selector+".thwecmf-column-padding{",col_props=prepare_builder_css_props(props,["width","text_align","p_t","p_r","p_b","p_l","b_t","b_r","b_b","b_l","border_style","border_color","bg_color"]),col_css=w_selector;return col_css+=builder_css_generator(col_props),col_css+="}"}function prepare_block_css_override(props,blockId,blockName,isPrev){var block_css="",count=(ELM_CSS_PROP_MAP[blockName],Object.keys(ELM_CSS_PROP_MAP[blockName]).length);return!$.isEmptyObject(ELM_CSS_PROP_MAP[blockName])&&count&&$.each(ELM_CSS_PROP_MAP[blockName],function(class_name,style){var table_props,p_selector=css_parent_selector(blockId,isPrev),w_selector=p_selector+class_name,table_props=prepare_builder_css_props(props,style);block_css+=w_selector+" {",block_css+=builder_css_generator(table_props),block_css+="}"}),block_css}function get_text_props(js_props,block_id,block_name){var text_css={};switch(block_name){case"billing_address":text_css={content:{class:".thwecmf-billing-header",attribute:"html"}};break;case"shipping_address":text_css={content:{class:".thwecmf-shipping-header",attribute:"html"}};break;case"text":text_css={textarea_content:{class:".thwecmf-block-text-holder",attribute:"html"}};break;case"image":text_css={upload_img_url:{class:"img",attribute:"image"}};break;default:text_css=""}return text_css}function reset_sidebar_status($configure){if($configure)var active="thwecmf-sidebar-configure",inactive="thwecmf-sidebar-settings",add_class=!0;else var active="thwecmf-sidebar-settings",inactive="thwecmf-sidebar-configure",add_class=!1;var settings_panel=$("#thwecmf-sidebar-element-wrapper"),previous_btn=settings_panel.find(".thwecmf-nav-previous");add_class?previous_btn.addClass("thwecmf-configure-page-index"):previous_btn.removeClass("thwecmf-configure-page-index"),settings_panel.find("#"+active).removeClass("inactive-tab").addClass("thwecmf-active-tab"),settings_panel.find("#"+inactive).removeClass("thwecmf-active-tab").addClass("inactive-tab")}
function initialize_sidebar_clicks(){$("#thwecmf-sidebar-settings").on("click",".thwecmf-elm-col",function(event){var form=$("#thwecmf_tbuilder_layout_elm_form");reset_sidebar_status("thwecmf-sidebar-configure","thwecmf-sidebar-configure");var block_identifier=get_field_value(form,"hidden","thwecmf_block_id"),col_count=get_field_value(form,"hidden","thwecmf_col_count");block_identifier=block_identifier||"",add_builder_elements($(this).find("div").data("block-name"),block_identifier,col_count),setup_builder_ui(),setup_sidebar_scrolls(!1)}),$(".thwecmf-tbuilder-wrapper").on("click",".thwecmf-btn-add-element",function(event){event.preventDefault(),setup_sidebar_content("layout-elements");var form=$("#thwecmf_tbuilder_layout_elm_form");if($(this).hasClass("panel-add-btn"))var click_elm=$(this).closest("div.thwecmf-columns").attr("id"),column_count=$(this).closest(".thwecmf-rows.thwecmf-panel-builder-block").attr("data-columns");else if($(this).hasClass("thwecmf-builder-add-btn"))var click_elm=$(this).closest("td").attr("id").replace("tbf_",""),column_count=$(this).closest(".thwecmf-row.thwecmf-builder-block").attr("data-column-count");set_field_value(form,"hidden","thwecmf_block_id",click_elm,0),set_field_value(form,"hidden","thwecmf_col_count",column_count,0),reset_sidebar_status(!1),$("#thwecmf-sidebar-settings").find(".thwecmf-tbuilder-elm-grid-layout-element .column-basic-elements .grid-category").removeClass("category-collapse"),setup_sidebar_panel_scrolls(!1,!1,!1,!0)}),$(".thwecmf-tbuilder-wrapper").on("click",".thwecmf-element-name,.thwecmf-hook-name",function(event){var clicked=$(this),panel_elm=clicked.closest(".thwecmf-panel-builder-block"),panel_elm_id=panel_elm.attr("id");highlight_focus_blocks($("#tbf_"+panel_elm_id),panel_elm)}),$("#tbf_t_builder").on("click",".thwecmf-block,.thwecmf-hook-code",function(event){var builder_elm=$(this),builder_elm_id=builder_elm.attr("id"),panel_elm_id=builder_elm_id.replace("tbf_","");highlight_focus_blocks(builder_elm,$(".thwecmf-builder-elm-layers").find("#"+panel_elm_id))}),$(".thwecmf-tbuilder-wrapper").on("click",".thwecmf-seperator-heading",function(event){var clicked=$(this).closest(".thwecmf-edit-form");if(clicked.hasClass("thwecmf-toggle-edit-section")){clicked.removeClass("thwecmf-toggle-edit-section");$(this).closest(".thwecmf_field_form_general").find(".thwecmf-edit-form").not(clicked).addClass("thwecmf-toggle-edit-section")}else clicked.addClass("thwecmf-toggle-edit-section")}),$(".thwecmf-tbuilder-wrapper").on("click",".thwecmf-aligment-icon-wrapper .img-wrapper",function(event){var icon_elm=$(this),icon_wrapper=$(this).closest(".thwecmf-aligment-icon-wrapper"),align_val=($("#thwecmf_builder_block_form"),icon_elm.attr("data-align"));icon_wrapper.find(".thwecmf-text-align-input").val(align_val),icon_wrapper.find(".thwecmf-active-icon").removeClass("thwecmf-active-icon"),icon_wrapper.find(".thwecmf-active-icon").removeClass("thwecmf-active-icon"),icon_elm.addClass("thwecmf-active-icon")})}function initialize_popups(){$("#thwecmf_confirmation_alerts").dialog({position:{my:"center",at:"center",of:$("#thwecmf-sidebar-element-wrapper")},draggable:!0,appendTo:"#thwecmf-sidebar-element-wrapper",modal:!0,width:275,resizable:!1,autoOpen:!1,dialogClass:"thwecmf-confirmations",buttons:[{text:"No",click:function(){$(this).dialog("close")}},{text:"Yes",click:function(){confirmation_tbuilder_clear(),$(this).dialog("close")}}]}).parent().draggable({containment:"#dialogContainer"})}function remove_image_uploaded(elm){var upload_pointer=$(elm),upload_preview=upload_pointer.siblings(".thwecmf-upload-preview"),default_url=upload_preview.attr("data-default-url");upload_preview.closest(".thwecmf-upload-action-settings").find(".thwecmf-upload-url").val(default_url),upload_pointer.closest(".thwecmf-upload-action-settings").find(".thwecmf-upload-preview img").attr("src",default_url),upload_pointer.closest(".thwecmf-upload-action-settings").find(".thwecmf-upload-preview img").attr("src",default_url);var notice_tag=upload_pointer.closest(".thwecmf-upload-action-settings").siblings(".thwecmf-upload-notices");notice_tag.find("p").length>0&&notice_tag.find("p").remove(),upload_pointer.addClass("thwecmf-remove-upload-inactive")}function setup_wp_image_upload(elm,prop){var frame,file_valid,validation_msg;frame=wp.media({title:"Upload Media Of Your Interest",button:{text:"Choose this"},multiple:!1}),frame.open(),frame.on("select",function(){var thwec_attachment=frame.state().get("selection").first().toJSON();"gif"==prop?(file_valid="image/gif"==thwec_attachment.mime,validation_msg="<p>Invalid file type. Choose a Gif file</p>"):(file_valid="image"==thwec_attachment.type&&-1!==$.inArray(thwec_attachment.mime,UPLOAD_FILE_TYPES),validation_msg="<p>Invalid file type. Choose an image file <br>[ jpg, jpeg, png ]</p>");var thwec_attachment_url=thwec_attachment.url,form_table=(thwec_attachment.name,$("#thwecmf_builder_block_form")),upload_block=form_table.find(".thwecmf-upload-action-settings.thwecmf-img-preview-"+prop);file_valid?("bg_image"==prop?set_field_value(form_table,"text","upload_bg_url",thwec_attachment_url,0):"image"!=prop&&"gif"!=prop||set_field_value(form_table,"text","upload_img_url",thwec_attachment_url,0),upload_block.find(".thwecmf-upload-preview img").attr("src",thwec_attachment_url),upload_block.find(".thwecmf-remove-upload-btn").hasClass("thwecmf-remove-upload-inactive")&&upload_block.find(".thwecmf-remove-upload-btn").removeClass("thwecmf-remove-upload-inactive"),upload_block.closest("td").find(".thwecmf-upload-notices").html("")):upload_block.closest("td").find(".thwecmf-upload-notices").html(validation_msg)})}function setup_builder_ui(){setup_sortable_sidebar_blocks("div.thwecmf-builder-elm-layers",".thwecmf-sortable-row-handle",".thwecmf-rows",".thwecmf-element-set,.thwecmf-builder-elm-layers",sortable_start_handler,sortable_out_handler,sortable_stop_handler,null,sortable_receive_handler,sortable_update_handler),setup_sortable_sidebar_blocks("div.thwecmf-column-set",".sortable-col-handle","> div.thwecmf-columns","",sortable_start_handler,sortable_out_handler,sortable_stop_handler,null,null,sortable_update_handler),setup_sortable_sidebar_blocks("div.thwecmf-element-set",".sortable-elm-handle","div.thwecmf-hooks,div.thwecmf-elements:not(.panel-add-btn)",".thwecmf-element-set,div.thwecmf-builder-elm-layers",sortable_start_handler,sortable_out_handler,sortable_stop_handler,null,null,sortable_update_handler)}function setup_sortable_sidebar_blocks(elm,handle,items,connectWith,start_handler,out_handler,stop_handler,over_handler,receive_handler,update_handler){$(elm).sortable({handle:handle,axis:"x,y",items:items,scroll:!0,cursor:"move",helper:"clone",placeholder:"sortable-row-placeholder",connectWith:connectWith,forcePlaceholderSize:!0,start:start_handler,out:out_handler,over:over_handler,stop:stop_handler,receive:receive_handler,update:update_handler}),$(elm).disableSelection()}function sortable_start_handler(event,ui){BLOCK_DRAGG=ui.item.attr("class"),BLOCK_DRAGG=$.trim(BLOCK_DRAGG.replace("thwecmf-panel-builder-block","")),$(ui.helper).addClass("dragg"),"thwecmf-rows"==BLOCK_DRAGG?(ui.helper.find(".thwecmf-column-set").css("display","none"),ui.helper.css("height","unset")):"thwecmf-columns"==BLOCK_DRAGG?(ui.helper.find(".thwecmf-element-set").css("display","none"),ui.helper.css("height","unset"),ui.placeholder.addClass("ui-sortable-placeholder-columns")):"thwecmf-elements"!=BLOCK_DRAGG&&"thwecmf-hooks"!=BLOCK_DRAGG||ui.placeholder.addClass("ui-sortable-placeholder-element-hooks")}function sortable_out_handler(event,ui){if(("thwecmf-rows"==BLOCK_DRAGG||"thwecmf-elements"==BLOCK_DRAGG)&&ui.item.closest(".thwecmf-columns").length>0){var prev_parent_id=ui.item.closest(".thwecmf-columns").attr("id");ui.item.data("prev-parent",prev_parent_id)}}function sortable_stop_handler(event,ui){$(ui.helper).removeClass("dragg"),$(this).hasClass("thwecmf-elements")&&ui.item.hasClass("thwecmf-elements")}function sortable_receive_handler(event,ui){!$(this).hasClass("thwecmf-builder-elm-layers")||"thwecmf-elements"!=BLOCK_DRAGG&&"thwecmf-hooks"!=BLOCK_DRAGG||(ui.placeholder.hide(),ui.sender.sortable("cancel"),alert("Cannot place an element outside a column"))}function sortable_update_handler(event,ui){var track_id="tbf_"+ui.item.attr("id"),next_id=ui.item.next().attr("id"),prev_id=ui.item.prev().attr("id");if(prev_id?(prev_id="tbf_"+prev_id,$($("#tbf_t_builder").find("#"+track_id)).insertAfter($("#"+prev_id))):(next_id="tbf_"+next_id,$($("#tbf_t_builder").find("#"+track_id)).insertBefore($("#"+next_id))),ui.item.closest(".thwecmf-element-set").closest(".thwecmf-columns").length>0){var prev_parent=ui.item.data("prev-parent"),track_id=(ui.item.closest(".thwecmf-element-set").closest(".thwecmf-columns").attr("id"),ui.item.attr("id")),next_id=ui.item.next().attr("id"),prev_id=ui.item.prev().attr("id");if(ui.item.closest(".thwecmf-columns").attr("id"))var column_id=ui.item.closest(".thwecmf-columns").attr("id");var data=$("#tbf_t_builder").find("#tbf_"+track_id);prev_id?$(data).insertAfter($("#tbf_"+prev_id)):next_id?$(data).insertBefore($("#tbf_"+next_id)):next_id||prev_id||$("#tbf_t_builder").find("#tbf_"+column_id).html(data);var prev_parent_ref=$("#tbf_"+prev_parent);prev_parent_ref.find(".thwecmf-builder-block").length<1&&prev_parent_ref.find(".thwecmf-hook-code").length<1&&$("#tbf_"+prev_parent).html(EMPTY_TD_DATA)}}function builder_prepare_save_template(elm){var json_tree=json_from_sb_layers(),template_name_valid=!0,blank_builder_valid=!0,template_builder=$("#tbf_t_builder"),block_length=template_builder.find(".thwecmf-block").length,hook_length=template_builder.find(".thwecmf-hook-code").length,tname=$("#thwecmf_template_save_name").val(),tcontent=$("#thwecmf_drag_n_drop").innerHTML,tcss=$("#thwecmf_template_css").html(),input_validation=validate_temp_name(tname,"Template");template_name_valid=0===input_validation.length,blank_builder_valid=block_length>0||hook_length>0,blank_builder_valid?template_name_valid?template_name_valid&&blank_builder_valid&&(template_builder.attr("data-track-save",template_builder.attr("data-global-id")),template_prepare_data(tname,tcontent,tcss,json_tree),template_builder.attr("data-css-change","true")):$.each(input_validation,function(key,value){value.status||alert(value.message)}):alert("Add elements to save the template")}function json_from_sb_layers(){var layer_data=$(".thwecmf-tbuilder-elm-wrapper").find(".thwecmf-sidebar-config-elm-layers .thwecmf-builder-elm-layers"),row_struct={},row_array=[];return layer_data.find("> .thwecmf-rows.thwecmf-panel-builder-block").each(function(index,el){var row_data={},col_array=[];$(this).find("> .thwecmf-column-set > .thwecmf-columns.thwecmf-panel-builder-block").each(function(index,el){var col_data={},elm_array=[];$(this).find("> .thwecmf-element-set > .thwecmf-panel-builder-block").each(function(index,el){var elm_data={};if($(this).hasClass("thwecmf-elements")){var json_blk_id=$(this).attr("id"),json_blk_name=$(this).find(".thwecmf-block-settings .thwecmf-template-action-edit").attr("data-icon-attr"),json_blk_obj=$("#tbf_"+json_blk_id);elm_data.data_id=json_blk_id,elm_data.data_type="element",elm_data.data_name=json_blk_name,elm_data.data_css=json_blk_obj.attr("data-css-props"),elm_data.data_text=json_blk_obj.attr("data-text-props"),elm_data.data_misc=is_content_inlcude_img(json_blk_name)?json_blk_obj.attr("data-misc"):"",elm_data.child=$(this).find(".thwecmf-element-name").text(),elm_array.push(elm_data)}else if($(this).hasClass("thwecmf-hooks")){elm_data.data_id=$(this).attr("id"),elm_data.data_type="hook";var hook_names=$(this).find(".thwecmf-hook-name").text(),hook_suffix="Downloadable Product"==hook_names?"table":"hook";hook_names=hook_names+"_"+hook_suffix,elm_data.data_name=hook_names.toLowerCase().replace(/\s+/g,"_"),elm_data.child=$(this).find(".thwecmf-hook-name").text(),elm_array.push(elm_data)}}),col_data.data_id=$(this).attr("id"),col_data.data_type="column",col_data.data_name=$(this).find(".thwecmf-block-settings .thwecmf-template-action-edit").attr("data-icon-attr"),col_data.data_css=$("#tbf_"+$(this).attr("id")).attr("data-css-props"),col_data.child=elm_array,col_array.push(col_data)}),row_data.data_id=$(this).attr("id"),row_data.data_type="row",row_data.data_name=$(this).find(".thwecmf-block-settings .thwecmf-template-action-edit").attr("data-icon-attr"),row_data.data_css=$("#tbf_"+$(this).attr("id")).attr("data-css-props"),row_data.data_text=$("#tbf_"+$(this).attr("id")).attr("data-text-props"),row_data.data_count=$("#tbf_"+$(this).attr("id")).attr("data-column-count"),row_data.child=col_array,row_array.push(row_data)}),row_struct.row=row_array,row_struct.data_id="t_builder",row_struct.data_type="builder",row_struct.track_save=$("#tbf_t_builder").attr("data-global-id"),row_struct.data_css=$("#tbf_t_builder").attr("data-css-props"),JSON.stringify(row_struct)}function template_prepare_data(name,content,css,json_tree){$("#thwecmf_template_save_name").attr("value",$("#thwecmf_template_save_name").val());template_preview_content(!0),prepare_ajax_save(name,$("#thwecmf_tbuilder_editor_preview").html(),css+$("#thwecmf_template_css_preview_override").html(),json_tree)}function prepare_ajax_save(name,template_data,css_cleaned,json_tree){var template_ajax_load=$("#thwecmf-ajax-load-modal"),sample_data={thwecmf_security:thwecmf_admin_var.ajax_nonce,action:"thwecmf_template_actions",thwecmf_action_index:"settings",template_name:name,template_render_data:template_data,template_render_css:css_cleaned,template_json_tree:json_tree};$.ajax({type:"POST",url:ajaxurl,data:sample_data,beforeSend:function(){template_ajax_load.addClass("thwecmf-ajax-loading")},success:function(data){var msg=data?"Template Saved":"Template or Settings was not Saved. Try again.",msg_class=data?"success":"error";$("#thwecmf_builder_save_messages").html(msg).addClass("thwecmf-show-save thwecmf-save-"+msg_class),setTimeout(function(){$("#thwecmf_builder_save_messages").removeClass("thwecmf-show-save thwecmf-save-"+msg_class)},3e3)},complete:function(){template_ajax_load.removeClass("thwecmf-ajax-loading")},error:function(){$("#thwecmf_builder_save_messages").html("Something went wrong").addClass("thwecmf-show-save thwecmf-save-error"),setTimeout(function(){$("#thwecmf_builder_save_messages").removeClass("thwecmf-show-save thwecmf-save-error")},3e3)}})}function template_preview_content(show_hooks){var preview_html=$("#tbf_t_builder").clone(!0);clean_preview_html_content(preview_html),preview_html.find(".thwecmf-btn-add-element").remove(),preview_html.find(".thwecmf-builder-block").each(function(index,el){var block_name=$(this).data("block-name");if(show_hooks&&manage_dynamic_address_support($(this),block_name),$(this).attr("id")){var id=$(this).attr("id");id=id.replace("tbf_","tpf_"),$(this).attr("id",id)}$(this).hasClass("thwecmf-row")&&$(this).find(" tbody> tr > .thwecmf-columns").each(function(index,el){var id=$(this).attr("id");id=id.replace("tbf_","tpf_"),$(this).attr("id",id)})}),preview_html.find(".thwecmf-builder-block").removeClass("thwecmf-builder-block"),preview_html.find("[data-css-props]").each(function(index,el){$(this).removeAttr("data-css-props"),$(this).attr("data-text-props")&&$(this).removeAttr("data-text-props")}),preview_html.removeAttr("data-css-props"),preview_html.removeAttr("data-global-id"),preview_html.removeAttr("data-track-save"),preview_html.removeAttr("data-css-change"),$("#thwecmf_tbuilder_editor_preview").html(preview_html)}function clean_preview_html_content(elm){elm.find("p.thwecmf-hook-code").each(function(index,el){$(this).removeAttr("id")}),elm.attr("id",elm.attr("id").replace("tbf_","tpf_")),elm.removeClass("thwecmf-dropable sortable ui-sortable ui-droppable"),elm.find(".thwecmf-icon-panel").remove(),elm.find(".thwecmf-columns .dashicons-edit").remove(),elm.find('input[type="hidden"]').remove(),elm.find(".thwecmf-columns").css("min-height","0"),elm.find(".ui-sortable").removeClass("ui-sortable ui-droppable")}function manage_dynamic_address_support(block_elm,block_name){"thwecmf_billing_address"==block_name&&hook_position_manager(block_elm,"{thwecmf_billing_address}","thwecmf-billing-body",!1,!1),"thwecmf_shipping_address"==block_name&&(hook_position_manager(block_elm,"{thwecmf_shipping_address}","thwecmf-shipping-body",!1,!1),extra_address_supports(block_elm,block_name))}function hook_position_manager($obj,$hook_name,$class_name,$control,$position){var elm_blk=$obj.closest(".thwecmf-element-block"),elm_col=$obj.closest(".thwecmf-columns"),row_col=$obj.closest(".thwecmf_column_layout"),insert="";$control?(insert=elm_blk.siblings().length?elm_blk:elm_blk.closest(".thwecmf-column-padding").length?elm_col:row_col,$position?$("<span>"+$hook_name+"</span>").insertAfter(insert):$("<span>"+$hook_name+"</span>").insertBefore(insert)):$obj.find("."+$class_name).html("<span>"+$hook_name+"</span>")}function extra_address_supports($elm,$name){if("thwecmf_shipping_address"==$name){var shipping_table=$elm.find("> tbody > tr > td");shipping_table.prepend("<span>{thwecmf_before_shipping_address}</span>"),shipping_table.append("<span>{thwecmf_after_shipping_address}</span>")}}function edit_template_event_listner(elm){var form=$("#thwecmf_edit_template_form"),template_to_edit=get_field_value(form,"select","edit_template");""==template_to_edit?(alert("Select a template to edit"),event.preventDefault()):-1==$.inArray(template_to_edit,WECMF_FREE_TEMP)?(alert("Cheating huh?"),event.preventDefault()):$('input[name="template_to_edit"]').val(template_to_edit)}function template_delete_action(){$("#delete_template").click(function(event){""==get_field_value($("#thwecmf_edit_template_form"),"select","edit_template")?(alert("Select template to delete"),event.preventDefault()):confirm("Delete the selected template ?")||event.preventDefault()})}function template_map_validation(event,elm){return!1}var preview_wrapper,BLOCK_DRAGG,BUILDER_ROWS=(new Array("configure","layouts","layout-element","settings"),new Array("one_column","two_column")),BUILDER_COLS=new Array("one_column_one","two_column_one","two_column_two"),BUILDER_HOOKS=new Array("email_header","email_order_details","before_order_table","after_order_table","order_meta","customer_details","email_footer","downloadable_product"),ADDRESS_BLOCKS=new Array("billing_address","shipping_address"),COL_TO_NUM={one_column:1,two_column:2,three_column:3,four_column:4},NUM_TO_WORDS={1:"one",2:"two",3:"three",4:"four"},UPLOAD_FILE_TYPES=new Array("image/jpeg","image/png","image/jpg"),TB_DEFAULT='{"b_t":"1px","b_r":"1px","b_b":"1px","b_l":"1px","border_style":"solid","border_color":"#dedede","bg_color":"#ffffff"}',LAYOUT_HELPER={},EMPTY_TD_DATA='<span class="thwecmf-builder-add-btn thwecmf-btn-add-element">+ Add Element</span>',DEF_COL_PROPS={width:"50%",p_t:"10px",p_r:"10px",p_b:"10px",p_l:"10px",b_t:"1px",b_r:"1px",b_b:"1px",b_l:"1px",border_style:"dotted",border_color:"#dddddd",bg_color:"none",text_align:"center"},TEST_MAIL_NOTICE="<span>Please enter a valid email id</span>",ELM_CSS_PROP_MAP=thwecmf_admin_var.elm_css_map,IMG_CONTENT_BLOCKS=(new Array("img_size_width","img_size_height"),new Array("header_details","image","gif","social"));!function(){preview_wrapper=$("#thwecmf_tbuilder_editor_preview"),initialize_sidebar_clicks(),initialize_popups(),setup_builder_ui(),resize_scroll_support(),reload_page_listner(),template_delete_action(),$(".thwecmf-template-map-select2").select2(),$(".thwecmf-template-map-select2.thwecmf-premium-disabled-input").prop("disabled",!0),$(".thwecmf-tbuilder-elm-wrapper").on("click",".thwecmf-column-name",function(event){$(this).closest(".thwecmf-columns").find(".thwecmf-element-set").toggle()}),$(".thwecmf-tbuilder-elm-wrapper").on("click",".thwecmf-row-name",function(event){$(this).closest(".thwecmf-rows").find(".thwecmf-column-set").toggle(),$(this).closest(".thwecmf-rows").toggleClass("rows-collpase")}),$(".thwecmf-tbuilder-header-panel").on("blur","input",function(){""!=$(this).val()?$(this).addClass("has-value"):$(this).removeClass("has-value")})}();var BUILDER_CSS_PROPS={p_t:{name:"padding-top"},p_r:{name:"padding-right"},p_b:{name:"padding-bottom"},p_l:{name:"padding-left"},m_t:{name:"margin-top"},m_r:{name:"margin-right"},m_b:{name:"margin-bottom"},m_l:{name:"margin-left"},width:{name:"width"},height:{name:"height"},size_width:{name:"width"},size_height:{name:"height"},b_t:{name:"border-top"},b_r:{name:"border-right"},b_b:{name:"border-bottom"},b_l:{name:"border-left"},border_style:{name:"border-style"},border_color:{name:"border-color"},upload_img_url:{name:"display"},bg_color:{name:"background-color"},color:{name:"color"},font_size:{name:"font-size"},text_align:{name:"text-align"},content_align:{name:"text-align"},align:{name:"float"},img_width:{name:"width"},img_height:{name:"height"},img_size_width:{name:"width"},img_size_height:{name:"height"},details_color:{name:"color"},details_font_size:{name:"font-size"},details_text_align:{name:"text-align"},divider_height:{name:"border-top-width"},divider_color:{name:"border-top-color"},divider_style:{name:"border-top-style"}},WECMF_FREE_TEMP=new Array("customer_processing_order","customer_new_account"),EDIT_FORM_PROPS={p_t:{name:"padding_top",type:"text"},p_r:{name:"padding_right",type:"text"},p_b:{name:"padding_bottom",type:"text"},p_l:{name:"padding_left",type:"text"},m_t:{name:"margin_top",type:"text"},m_r:{name:"margin_right",type:"text"},m_b:{name:"margin_bottom",type:"text"},m_l:{name:"margin_left",type:"text"},width:{name:"width",type:"text"},height:{name:"height",type:"text"},size_width:{name:"size_width",type:"text"},size_height:{name:"size_height",type:"text"},img_size_width:{name:"img_size_width",type:"text"},img_size_height:{name:"img_size_height",type:"text"},b_t:{name:"border_width_top",type:"text"},b_r:{name:"border_width_right",type:"text"},b_b:{name:"border_width_bottom",type:"text"},b_l:{name:"border_width_left",type:"text"},border_style:{name:"border_style",type:"select"},border_color:{name:"border_color",type:"text"},bg_color:{name:"bg_color",type:"text"},upload_img_url:{name:"upload_img_url",type:"text",attribute:"yes"},content:{name:"content",type:"text",attribute:"yes"},color:{name:"color",type:"text"},font_size:{name:"font_size",type:"text"},text_align:{name:"text_align",type:"hidden"},content_align:{name:"content_align",type:"hidden"},url:{name:"url",type:"text",attribute:"yes"},title:{name:"title",type:"text",attribute:"yes"},align:{name:"align",type:"hidden"},img_width:{name:"img_width",type:"text"},img_height:{name:"img_height",type:"text"},details_color:{name:"details_color",type:"text"},details_font_size:{name:"details_font_size",type:"text"},details_text_align:{name:"details_text_align",type:"hidden"},textarea_content:{name:"textarea_content",type:"textarea",attribute:"yes"},divider_height:{name:"divider_height",type:"text"},divider_color:{name:"divider_color",type:"text"},divider_style:{name:"divider_style",type:"select"}},DEFAULT_CSS={color:"transparent","background-color":"transparent","border-color":"transparent","background-color":"transparent","padding-top":"0px","padding-right":"0px","padding-bottom":"0px","padding-left":"0px"};return{render_edit_block_sidebar_form:render_edit_block_sidebar_form,setup_category_toggle:setup_category_toggle,click_block_edit_sidebar_form_save:click_block_edit_sidebar_form_save,delete_builder_blocks:delete_builder_blocks,clear_tbuilder_sidebar:clear_tbuilder_sidebar,setup_wp_image_upload:setup_wp_image_upload,add_row_builder_action:add_row_builder_action,template_sidebar_back_navigation:template_sidebar_back_navigation,remove_image_uploaded:remove_image_uploaded,click_test_mail_button:click_test_mail_button,close_test_mail_box:close_test_mail_box,click_test_mail_action:click_test_mail_action,builder_prepare_save_template:builder_prepare_save_template,edit_template_event_listner:edit_template_event_listner,template_map_validation:template_map_validation}}(window.jQuery,window,document);